<div class="bb b--black-10">
  <section class="dt w-100 ph4 center">
    <div class="dtc v-mid">
      <h1 class="f4 mb1">
        <% if @function.private? %>
          <i class="fa fa-lock gold mr1" aria-hidden="true"></i>
        <% end %>
        <a href="<%= user_path(@function.user.username) %>" class="no-underline blue dim">
          <%= @function.user.username %>
        </a>
        <span class="black-30">/</span>
        <a href="<%= user_function_path(@function.user.username, @function.name) %>" class="no-underline blue dim">
          <%= @function.name %>
        </a>
      </h1>
      <h2 class="f6 fw4 mt0 mb3">
        <% if @function.description.present? %>
          <div class="black-60 truncate"><%= @function.description %></div>
        <% else %>
          <div class="black-40 i">No description.</div>
        <% end %>
      </h2>
    </div>
    <div class="dtc v-mid">
      <div class="f5 tr mb1 black-60"><%= @function.runtime_name %></div>
      <div class="f6 tr black-40">
        <span title="<%= @function.created_at %>">Created <%= time_ago_in_words(@function.created_at) %> ago.</span>
        <% if current_user&.id == @function.user_id %>
          <%= link_to 'Settings', edit_function_path(@function), class: 'blue pl11' %>
        <% end %>
      </div>
    </div>
  </section>
</div>

<main class="w-100 center cf js-stretch-to-bottom">
  <div class="fl w-60 h-100 code-editor-container" ng-controller="functions-app.function-editor-controller" ng-cloak>
    <div
      ui-codemirror="{onLoad : codemirrorLoaded}"
      ng-model="function.code_with_template" class="h-100"></div>
  </div>

  <div class="fr w-40 bl b--black-10 h-100 pa4 code-runner-container" ng-controller="functions-app.function-invocation-controller" ng-cloak>
    <p class="f4 b mv0">Run the function</p>
    <p class="black-50 lh-copy f6">Supply JSON input to the function (if applicable) and press the "Run" button to try it out.</p>
    <textarea
      class="code-input pa2 input-reset hover-bg-white b--black-20 black w-100"
      rows="4"
      ng-model="invocationRequest.payload"
      ui-codemirror="{onLoad : codemirrorLoaded}">
    </textarea>
    <button class="f6 bn grow br2 ph3 pv2 mt2 mb2 dib white bg-pink " ng-click="invokeFunction()" ng-disabled="state.invoking">
      <span class="pr2">{{ state.invoking ? 'Running' : 'Run' }}</span>
      <i class="fa fa-play" aria-hidden="true" ng-show="!state.invoking"></i>
      <i class="fa fa-spinner" aria-hidden="true" ng-show="state.invoking"></i>
    </button>

    <div ng-if="invocation">
      <p ng-if="invocation.error" class="light-red f6">There was an error of type <b>{{invocation.error}}</b>.</p>
      <p ng-if="!invocation.error" class="green f6">Your request completed successfully.</p>
      <textarea class="code-input pa2 input-reset hover-bg-white b--black-20 black w-100" rows="4" ng-if="!invocation.error" spellcheck="false">{{invocation.payload}}</textarea>
      <p ng-if="invocation.log" class="f6">
        <a class="blue" ng-click="expandLogs()">
          View logs
          <i class="fa fa-external-link" aria-hidden="true"></i>
        </a>
      </p>
    </div>
  </div>
</main>
