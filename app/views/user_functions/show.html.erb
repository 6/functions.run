<div class="bb b--black-10">
  <section class="dt w-100 ph4 center">
    <div class="dtc v-mid">
      <h1 class="f4 mb1">
        <a href="<%= user_path(@function.user.username) %>" class="no-underline blue dim">
          <%= @function.user.username %>
        </a>
        <span class="black-30">/</span>
        <a href="<%= user_function_path(@function.user.username, @function.name) %>" class="no-underline blue dim">
          <%= @function.name %>
        </a>
      </h1>
      <h2 class="f6 fw4 mt0 mb3">
        <% if @function.description %>
          <div class="black-60 truncate"><%= @function.description %></div>
        <% else %>
          <div class="black-40 i">No description.</div>
        <% end %>
      </h2>
    </div>
    <div class="dtc v-mid">
      <div class="f5 tr mb1 black-60"><%= @function.runtime_name %></div>
      <div class="f6 tr black-40">
        <span title="<%= @function.created_at %>">Created <%= time_ago_in_words(@function.created_at) %> ago.</span>
        <% if current_user&.id == @function.user_id %>
          <%= link_to 'Delete', @function,  method: :delete, data: { confirm: 'Are you sure?' }, class: "light-red" %>
        <% end %>
      </div>
    </div>
  </section>
</div>

<main class="w-100 center cf js-stretch-to-bottom">
  <div class="fl w-60 h-100" ng-controller="functions-app.function-editor-controller">
    <div
      ui-codemirror="{onLoad : codemirrorLoaded}"
      ng-model="function.code_with_template" class="h-100"></div>
  </div>

  <div class="fr w-40 bl b--black-10 h-100 pa4" ng-controller="functions-app.function-invocation-controller">
    <p class="f4 b mv0">Run the function</p>
    <p class="black-50 lh-copy f6">Supply input to the function (if applicable) and press the "Run" button to try it out.</p>
    <textarea class="code-input pa2 input-reset hover-bg-white b--black-20 black w-100" rows="4" placeholder='Enter your function input here in JSON format.' ng-model="invocationRequest.payload"></textarea>
    <button class="f6 bn grow br2 ph3 pv2 mt2 mb2 dib white bg-pink cursor-pointer" ng-click="invokeFunction()" ng-disabled="state.invoking">
      Run <i class="icono-play ml2"></i>
    </button>

    <div ng-if="invocation">
      <p class="f4 b mv0">Output</p>
      <p ng-if="invocation.error" class="light-red f6">There was an error of type <b>{{invocation.error}}</b>.</p>
      <p ng-if="!invocation.error" class="green f6">Your request completed successfully.</p>
      <textarea class="code-input pa2 input-reset hover-bg-white b--black-20 black w-100" rows="4" ng-if="!invocation.error">{{invocation.payload}}</textarea>
      <div ng-if="invocation.log">
        <p>View log:</p>
        <textarea class="code-input pa2 input-reset hover-bg-white b--black-20 black w-100" rows="4">{{invocation.log}}</textarea>
      </div>
    </div>
  </div>
</main>

<script>
  window.data = {function: <%= @function.as_json.to_json.html_safe %>};
</script>
